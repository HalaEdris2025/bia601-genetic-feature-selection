private List<double[]> dataset = new List<double[]>();
private const int FeatureCount = 5;
protected void Page_Load(object sender, EventArgs e) { }

protected void btnRun_Click(object sender, EventArgs e)
{
    try
    {
        string dataPath = Server.MapPath("housing.csv");

        if (!File.Exists(dataPath))
        {
            lblResults.Text = "âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (housing.csv)";
            return;
        }

        dataset = LoadCsv(dataPath);
        if (dataset.Count == 0)
        {
            lblResults.Text = "âŒ Ø§Ù„Ù…Ù„Ù ÙØ§Ø±Øº Ø£Ùˆ ØºÙŠØ± ØµØ§Ù„Ø­.";
            return;
        }

        int generations = int.Parse(txtGenerations.Text);
        int populationSize = int.Parse(txtPopulation.Text);
        double crossoverRate = double.Parse(txtCrossover.Text);
        double mutationRate = double.Parse(txtMutation.Text);

        lblResults.Text = "<h4>ğŸš€ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ§Øª...</h4>";

        double mseGA = RunGenetic(generations, populationSize, crossoverRate, mutationRate);
        double mseLR = LinearRegression();
        double mseLasso = LassoRegression(0.001);
        double msePCA = PCARegression();

        lblResults.Text += "<hr><h4>ğŸ† Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡ (MSE):</h4>";
        lblResults.Text += $"Genetic Algorithm = {mseGA:F4}<br>";
        lblResults.Text += $"Linear Regression = {mseLR:F4}<br>";
        lblResults.Text += $"Lasso Regression = {mseLasso:F4}<br>";
        lblResults.Text += $"PCA Regression = {msePCA:F4}<br>";

        double best = Math.Min(Math.Min(mseGA, mseLR), Math.Min(mseLasso, msePCA));
        string bestName =
            best == mseGA ? "Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„Ø¬ÙŠÙ†ÙŠØ©" :
            best == mseLR ? "Ø§Ù„Ø§Ù†Ø­Ø¯Ø§Ø± Ø§Ù„Ø®Ø·ÙŠ" :
            best == mseLasso ? "Lasso Regression" : "PCA Regression";

        lblResults.Text += $"<br><b>ğŸ¥‡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£ÙØ¶Ù„ Ù‡Ùˆ:</b> {bestName}<br>";
    }
    catch (Exception ex)
    {
        lblResults.Text = "âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙ†ÙÙŠØ°: " + ex.Message;
    }
}

private List<double[]> LoadCsv(string path)
{
    var lines = File.ReadAllLines(path).Skip(1);
    var data = new List<double[]>();

    foreach (var line in lines)
    {
        var parts = line.Split(',');
        if (parts.Length < 6) continue;

        double[] row = new double[6];
        bool valid = true;
        for (int i = 0; i < 6; i++)
        {
            if (!double.TryParse(parts[i], out row[i]))
            {
                valid = false; break;
            }
        }

        if (valid) data.Add(row);
    }
    return data;
}

